<template>
  <div id="dashboard">
    <PermanentFull
      :titre="titre"
      :icon="icon"
      :menuItems="menuItems"
      :typeAbonnement="typeAbonnement"
      :dateExpiration="dateExpiration"
      :emplacementDispo="emplacementDispo"
    >
      <div
        id="content-dashboard-wrapper"
        class="md-layout-item d-flex flex-column"
      >
        <BlocAbonnement
          :typeAbonnement="typeAbonnement"
          :dateExpiration="dateExpiration"
          :emplacementDispo="emplacementDispo"
          :emplacementUtilise="emplacementUtilise"
          :titreAbonnement="$t('yourSubscription')"
        ></BlocAbonnement>
        <div class="dashboard-border p-4 flex-grow-1 d-flex flex-column">
          <CoupleCrypto
            v-on:refresh="refresh"
            :data="dataContentCoupleCrypto"
          ></CoupleCrypto>
          <div class="loader-content" v-if="loading">
            <md-progress-spinner md-mode="indeterminate"></md-progress-spinner>
          </div>
        </div>
      </div>
      <div id="content-sidebar-wrapper" class="md-layout-item">
        <Sidebar
          ref="sideBar"
          v-on:refresh="refresh"
          class="dashboard-border d-flex flex-column"
        ></Sidebar>
      </div>
    </PermanentFull>
  </div>
</template>

<script>
import PermanentFull from "../PermanentFull/PermanentFull.vue";
import MenuUser from "../../data/MenuUser.js";
import { formatDate } from "../../utils/Constant";
import BlocAbonnement from "../BlocAbonnement/BlocAbonnement.vue";
import CoupleCrypto from "../CoupleCrypto/CoupleCrypto.vue";
import Sidebar from "../Sidebar/Sidebar.vue";
import { mapGetters } from "vuex";

export default {
  name: "Dashboard",
  components: {
    PermanentFull,
    BlocAbonnement,
    CoupleCrypto,
    Sidebar,
  },
  data: function() {
    return {
      titre: `${this.$t("dashboard")}`,
      icon: `
        <svg class="mr-2 Trac_19678_br" width="27" height="29" viewBox="3 2 27 29.16">
          <path id="Trac_19678_br" d="M 28.45499801635742 8.644999504089355 L 16.5 2 L 4.545000076293945 8.644999504089355 L 12.15000057220459 12.85999965667725 C 13.24499988555908 11.71999931335449 14.78999900817871 11 16.5 11 C 18.21000099182129 11 19.75500106811523 11.71999931335449 20.84999847412109 12.85999965667725 L 28.45499801635742 8.644999504089355 Z M 13.5 17 C 13.5 15.34999847412109 14.84999847412109 14 16.5 14 C 18.15000152587891 14 19.5 15.34999847412109 19.5 17 C 19.5 18.65000152587891 18.15000152587891 20 16.5 20 C 14.84999847412109 20 13.5 18.65000152587891 13.5 17 Z M 15 31.15999984741211 L 3 24.5 L 3 11.21000099182129 L 10.69499969482422 15.48500061035156 C 10.55999946594238 15.96500015258789 10.5 16.47499847412109 10.5 17 C 10.5 19.78999900817871 12.40500068664551 22.14500045776367 15 22.80500030517578 L 15 31.15999984741211 Z M 18 31.15999984741211 L 18 22.80500030517578 C 20.59499931335449 22.1450023651123 22.5 19.79000091552734 22.5 17.00000190734863 C 22.5 16.47500038146973 22.44000053405762 15.96500205993652 22.30500030517578 15.48500061035156 L 30 11.21000099182129 L 30 24.5 L 18 31.15999984741211 Z">
          </path>
        </svg>
      `,
      menuItems: MenuUser,
      typeAbonnement: "",
      dateExpiration: "",
      emplacementDispo: "",
      emplacementUtilise: "",
      loading: false,
      dataContentCoupleCrypto: [
        {
          titre: `${this.$t("myPairs")}`,
          icon: `
              <svg class="mr-2  Trac_42047" width="18" height="18" viewBox="3 3 18 18">
                <path id="Trac_42047" d="M 19 3 L 5 3 C 3.900000095367432 3 3 3.900000095367432 3 5 L 3 19 C 3 20.10000038146973 3.900000095367432 21 5 21 L 19 21 C 20.10000038146973 21 21 20.10000038146973 21 19 L 21 5 C 21 3.900000095367432 20.10000038146973 3 19 3 Z M 14 17 L 7 17 L 7 15 L 14 15 L 14 17 Z M 17 13 L 7 13 L 7 11 L 17 11 L 17 13 Z M 17 9 L 7 9 L 7 7 L 17 7 L 17 9 Z" fill="#a7aaae">
                </path>
              </svg>
            `,
          iconVide: `
              <svg class="Trac_42084" width=89.691 height=89.83 viewBox="160.518 67.788 89.691 89.83">
                <path id="Trac_42084" d="M 205.2957458496094 67.78800201416016 C 180.586181640625 67.78800201416016 160.5180358886719 87.85453033447266 160.5180358886719 112.7027969360352 C 160.5180358886719 137.5494079589844 180.586181640625 157.6175842285156 205.2957458496094 157.6175842285156 C 230.1407470703125 157.6175842285156 250.2088928222656 137.5494079589844 250.2088928222656 112.7027969360352 C 250.2088928222656 87.85453033447266 230.1407470703125 67.78800201416016 205.2957458496094 67.78800201416016 L 205.2957458496094 67.78800201416016 Z M 205.2957458496094 154.0675964355469 L 205.2957458496094 154.0675964355469 C 182.4949340820312 154.0675964355469 163.9293212890625 135.4986877441406 163.9293212890625 112.7027969360352 C 163.9293212890625 89.76491546630859 182.4949340820312 71.33799743652344 205.2957458496094 71.33799743652344 C 228.2286987304688 71.33799743652344 246.6605529785156 89.76491546630859 246.6605529785156 112.7027969360352 C 246.6605529785156 135.4986877441406 228.2286987304688 154.0675964355469 205.2957458496094 154.0675964355469 L 205.2957458496094 154.0675964355469 Z M 184.2699279785156 101.5095901489258 L 184.2699279785156 101.5095901489258 C 184.2699279785156 97.82089996337891 187.4120788574219 94.68039703369141 191.0974426269531 94.68039703369141 C 194.9215393066406 94.68039703369141 198.0603942871094 97.82089996337891 198.0603942871094 101.5095901489258 C 198.0603942871094 105.3270797729492 194.9215393066406 108.4692306518555 191.0974426269531 108.4692306518555 C 187.4120788574219 108.4692306518555 184.2699279785156 105.3270797729492 184.2699279785156 101.5095901489258 L 184.2699279785156 101.5095901489258 Z M 230.0053405761719 119.6640853881836 L 230.0053405761719 119.6640853881836 C 227.0018920898438 129.765869140625 217.58203125 137.4140319824219 206.3871765136719 137.2753295898438 C 195.0585632324219 137.2753295898438 185.6370849609375 129.765869140625 182.6319580078125 119.5270309448242 C 187.8215637207031 127.0381393432617 196.5578308105469 132.0890502929688 206.3871765136719 132.0890502929688 C 216.2165222167969 132.0890502929688 224.9528198242188 127.0381393432617 230.0053405761719 119.6640853881836 L 230.0053405761719 119.6640853881836 Z M 227.2743225097656 104.2373123168945 L 227.2743225097656 104.2373123168945 L 212.1199951171875 104.2373123168945 L 212.1199951171875 98.91233062744141 L 227.2743225097656 98.91233062744141 L 227.2743225097656 104.2373123168945 Z" fill="#A7AAAE">
                </path>
              </svg>
            `,
          titremessageVide: `${this.$t("emptyMyPair")}`,
          messageVide: `${this.$t("emptyMyPairMessage")}`,
          listing: [],
        },
        {
          titre: `${this.$t("myFavorites")}`,
          icon: `
              <svg class="mr-2  Path_kk" width="17" height="14" viewBox="0 0 17 14">
                <path id="Path_kk" d="M 8.5 14 L 8.263247489929199 13.81545066833496 C 7.81428337097168 13.46263408660889 7.206521511077881 13.07996559143066 6.50203800201416 12.63758850097656 C 3.75772762298584 10.91014862060547 0 8.546282768249512 0 4.516041278839111 C 0 2.025976419448853 2.15531587600708 0 4.804347991943359 0 C 6.243630886077881 0 7.59196662902832 0.6025007367134094 8.5 1.632451415061951 C 9.40803337097168 0.6025007367134094 10.75636863708496 0 12.19565200805664 0 C 14.84468460083008 0 17 2.025976419448853 17 4.516041278839111 C 17 8.546282768249512 13.24227237701416 10.91014862060547 10.49796199798584 12.63758850097656 C 9.793478012084961 13.07996559143066 9.18571662902832 13.46263408660889 8.736752510070801 13.81545066833496 L 8.5 14 Z" fill="#a7aaae">
                </path>
              </svg>
            `,
          iconVide: `
              <svg class="Trac_42084" width=89.691 height=89.83 viewBox="160.518 67.788 89.691 89.83">
                <path id="Trac_42084" d="M 205.2957458496094 67.78800201416016 C 180.586181640625 67.78800201416016 160.5180358886719 87.85453033447266 160.5180358886719 112.7027969360352 C 160.5180358886719 137.5494079589844 180.586181640625 157.6175842285156 205.2957458496094 157.6175842285156 C 230.1407470703125 157.6175842285156 250.2088928222656 137.5494079589844 250.2088928222656 112.7027969360352 C 250.2088928222656 87.85453033447266 230.1407470703125 67.78800201416016 205.2957458496094 67.78800201416016 L 205.2957458496094 67.78800201416016 Z M 205.2957458496094 154.0675964355469 L 205.2957458496094 154.0675964355469 C 182.4949340820312 154.0675964355469 163.9293212890625 135.4986877441406 163.9293212890625 112.7027969360352 C 163.9293212890625 89.76491546630859 182.4949340820312 71.33799743652344 205.2957458496094 71.33799743652344 C 228.2286987304688 71.33799743652344 246.6605529785156 89.76491546630859 246.6605529785156 112.7027969360352 C 246.6605529785156 135.4986877441406 228.2286987304688 154.0675964355469 205.2957458496094 154.0675964355469 L 205.2957458496094 154.0675964355469 Z M 184.2699279785156 101.5095901489258 L 184.2699279785156 101.5095901489258 C 184.2699279785156 97.82089996337891 187.4120788574219 94.68039703369141 191.0974426269531 94.68039703369141 C 194.9215393066406 94.68039703369141 198.0603942871094 97.82089996337891 198.0603942871094 101.5095901489258 C 198.0603942871094 105.3270797729492 194.9215393066406 108.4692306518555 191.0974426269531 108.4692306518555 C 187.4120788574219 108.4692306518555 184.2699279785156 105.3270797729492 184.2699279785156 101.5095901489258 L 184.2699279785156 101.5095901489258 Z M 230.0053405761719 119.6640853881836 L 230.0053405761719 119.6640853881836 C 227.0018920898438 129.765869140625 217.58203125 137.4140319824219 206.3871765136719 137.2753295898438 C 195.0585632324219 137.2753295898438 185.6370849609375 129.765869140625 182.6319580078125 119.5270309448242 C 187.8215637207031 127.0381393432617 196.5578308105469 132.0890502929688 206.3871765136719 132.0890502929688 C 216.2165222167969 132.0890502929688 224.9528198242188 127.0381393432617 230.0053405761719 119.6640853881836 L 230.0053405761719 119.6640853881836 Z M 227.2743225097656 104.2373123168945 L 227.2743225097656 104.2373123168945 L 212.1199951171875 104.2373123168945 L 212.1199951171875 98.91233062744141 L 227.2743225097656 98.91233062744141 L 227.2743225097656 104.2373123168945 Z" fill="#A7AAAE">
                </path>
              </svg>
            `,
          titremessageVide: `${this.$t("emptyMyfavorite")}`,
          messageVide: `${this.$t("emptyMyfavoriteMessage")}`,
          listing: [],
        },
      ],
    };
  },
  methods: {
    formatDate,
    loadCouples: async function() {
      try {
        this.loading = true;
        await this.$store.dispatch("loadDataCouples", {
          token: localStorage.getItem("token"),
        });
      } catch (e) {
        //
      } finally {
        this.loading = false;
      }
    },
    getInfoClient: async function() {
      try {
        await this.$store.dispatch("loadClients", {
          token: localStorage.getItem("token"),
        });
        this.typeAbonnement = this.client.subscription.name;
        this.dateExpiration = this.formatDate(
          this.$t("dateFormat"),
          this.client.subscription.end
        );
        this.emplacementUtilise = this.client.subscription.number_couple.toString();
        this.emplacementDispo = this.client.subscription.number_couple_offered.toString();
      } catch (e) {
        //
      } finally {
        this.loading = false;
      }
    },
    getUserCouple: async function() {
      try {
        this.loading = true;
        await this.$store.dispatch("getUserCouple", {
          token: localStorage.getItem("token"),
        });
        this.dataContentCoupleCrypto[0].listing = this.userCouple.data;
      } catch (e) {
        //
      } finally {
        this.loading = false;
      }
    },
    getFavoriteCouple: async function() {
      try {
        this.loading = true;
        await this.$store.dispatch("getFavoriteCouple", {
          token: localStorage.getItem("token"),
        });
        this.dataContentCoupleCrypto[1].listing = this.couplesDashboard.data;
      } catch (e) {
        //
      } finally {
        this.loading = false;
      }
    },
    async refresh() {
      this.loading = true;
      await this.getFavoriteCouple();
      await this.getUserCouple();
      this.$refs.sideBar.refreshSideBar();
      this.loading = false;
    },
  },
  async mounted() {
    await this.getInfoClient();
    await this.loadCouples();
    await this.getUserCouple();
    await this.getFavoriteCouple();
  },
  computed: {
    ...mapGetters(["couplesDashboard", "userCouple"]),
    client() {
      return this.$store.state.client.clients;
    },
  },
  watch: {
    "$i18n.locale"() {
      this.dateExpiration = this.formatDate(
        this.$t("dateFormat"),
        this.client.subscription.end
      );
      const listing1 = this.dataContentCoupleCrypto[0].listing;
      const listing2 = this.dataContentCoupleCrypto[1].listing;

      this.dataContentCoupleCrypto = [
        {
          titre: `${this.$t("myPairs")}`,
          icon: `
              <svg class="mr-2  Trac_42047" width="18" height="18" viewBox="3 3 18 18">
                <path id="Trac_42047" d="M 19 3 L 5 3 C 3.900000095367432 3 3 3.900000095367432 3 5 L 3 19 C 3 20.10000038146973 3.900000095367432 21 5 21 L 19 21 C 20.10000038146973 21 21 20.10000038146973 21 19 L 21 5 C 21 3.900000095367432 20.10000038146973 3 19 3 Z M 14 17 L 7 17 L 7 15 L 14 15 L 14 17 Z M 17 13 L 7 13 L 7 11 L 17 11 L 17 13 Z M 17 9 L 7 9 L 7 7 L 17 7 L 17 9 Z" fill="#a7aaae">
                </path>
              </svg>
            `,
          iconVide: `
              <svg class="Trac_42084" width=89.691 height=89.83 viewBox="160.518 67.788 89.691 89.83">
                <path id="Trac_42084" d="M 205.2957458496094 67.78800201416016 C 180.586181640625 67.78800201416016 160.5180358886719 87.85453033447266 160.5180358886719 112.7027969360352 C 160.5180358886719 137.5494079589844 180.586181640625 157.6175842285156 205.2957458496094 157.6175842285156 C 230.1407470703125 157.6175842285156 250.2088928222656 137.5494079589844 250.2088928222656 112.7027969360352 C 250.2088928222656 87.85453033447266 230.1407470703125 67.78800201416016 205.2957458496094 67.78800201416016 L 205.2957458496094 67.78800201416016 Z M 205.2957458496094 154.0675964355469 L 205.2957458496094 154.0675964355469 C 182.4949340820312 154.0675964355469 163.9293212890625 135.4986877441406 163.9293212890625 112.7027969360352 C 163.9293212890625 89.76491546630859 182.4949340820312 71.33799743652344 205.2957458496094 71.33799743652344 C 228.2286987304688 71.33799743652344 246.6605529785156 89.76491546630859 246.6605529785156 112.7027969360352 C 246.6605529785156 135.4986877441406 228.2286987304688 154.0675964355469 205.2957458496094 154.0675964355469 L 205.2957458496094 154.0675964355469 Z M 184.2699279785156 101.5095901489258 L 184.2699279785156 101.5095901489258 C 184.2699279785156 97.82089996337891 187.4120788574219 94.68039703369141 191.0974426269531 94.68039703369141 C 194.9215393066406 94.68039703369141 198.0603942871094 97.82089996337891 198.0603942871094 101.5095901489258 C 198.0603942871094 105.3270797729492 194.9215393066406 108.4692306518555 191.0974426269531 108.4692306518555 C 187.4120788574219 108.4692306518555 184.2699279785156 105.3270797729492 184.2699279785156 101.5095901489258 L 184.2699279785156 101.5095901489258 Z M 230.0053405761719 119.6640853881836 L 230.0053405761719 119.6640853881836 C 227.0018920898438 129.765869140625 217.58203125 137.4140319824219 206.3871765136719 137.2753295898438 C 195.0585632324219 137.2753295898438 185.6370849609375 129.765869140625 182.6319580078125 119.5270309448242 C 187.8215637207031 127.0381393432617 196.5578308105469 132.0890502929688 206.3871765136719 132.0890502929688 C 216.2165222167969 132.0890502929688 224.9528198242188 127.0381393432617 230.0053405761719 119.6640853881836 L 230.0053405761719 119.6640853881836 Z M 227.2743225097656 104.2373123168945 L 227.2743225097656 104.2373123168945 L 212.1199951171875 104.2373123168945 L 212.1199951171875 98.91233062744141 L 227.2743225097656 98.91233062744141 L 227.2743225097656 104.2373123168945 Z" fill="#A7AAAE">
                </path>
              </svg>
            `,
          titremessageVide: `${this.$t("emptyMyPair")}`,
          messageVide: `${this.$t("emptyMyPairMessage")}`,
          listing: listing1,
        },
        {
          titre: `${this.$t("myFavorites")}`,
          icon: `
              <svg class="mr-2  Path_kk" width="17" height="14" viewBox="0 0 17 14">
                <path id="Path_kk" d="M 8.5 14 L 8.263247489929199 13.81545066833496 C 7.81428337097168 13.46263408660889 7.206521511077881 13.07996559143066 6.50203800201416 12.63758850097656 C 3.75772762298584 10.91014862060547 0 8.546282768249512 0 4.516041278839111 C 0 2.025976419448853 2.15531587600708 0 4.804347991943359 0 C 6.243630886077881 0 7.59196662902832 0.6025007367134094 8.5 1.632451415061951 C 9.40803337097168 0.6025007367134094 10.75636863708496 0 12.19565200805664 0 C 14.84468460083008 0 17 2.025976419448853 17 4.516041278839111 C 17 8.546282768249512 13.24227237701416 10.91014862060547 10.49796199798584 12.63758850097656 C 9.793478012084961 13.07996559143066 9.18571662902832 13.46263408660889 8.736752510070801 13.81545066833496 L 8.5 14 Z" fill="#a7aaae">
                </path>
              </svg>
            `,
          iconVide: `
              <svg class="Trac_42084" width=89.691 height=89.83 viewBox="160.518 67.788 89.691 89.83">
                <path id="Trac_42084" d="M 205.2957458496094 67.78800201416016 C 180.586181640625 67.78800201416016 160.5180358886719 87.85453033447266 160.5180358886719 112.7027969360352 C 160.5180358886719 137.5494079589844 180.586181640625 157.6175842285156 205.2957458496094 157.6175842285156 C 230.1407470703125 157.6175842285156 250.2088928222656 137.5494079589844 250.2088928222656 112.7027969360352 C 250.2088928222656 87.85453033447266 230.1407470703125 67.78800201416016 205.2957458496094 67.78800201416016 L 205.2957458496094 67.78800201416016 Z M 205.2957458496094 154.0675964355469 L 205.2957458496094 154.0675964355469 C 182.4949340820312 154.0675964355469 163.9293212890625 135.4986877441406 163.9293212890625 112.7027969360352 C 163.9293212890625 89.76491546630859 182.4949340820312 71.33799743652344 205.2957458496094 71.33799743652344 C 228.2286987304688 71.33799743652344 246.6605529785156 89.76491546630859 246.6605529785156 112.7027969360352 C 246.6605529785156 135.4986877441406 228.2286987304688 154.0675964355469 205.2957458496094 154.0675964355469 L 205.2957458496094 154.0675964355469 Z M 184.2699279785156 101.5095901489258 L 184.2699279785156 101.5095901489258 C 184.2699279785156 97.82089996337891 187.4120788574219 94.68039703369141 191.0974426269531 94.68039703369141 C 194.9215393066406 94.68039703369141 198.0603942871094 97.82089996337891 198.0603942871094 101.5095901489258 C 198.0603942871094 105.3270797729492 194.9215393066406 108.4692306518555 191.0974426269531 108.4692306518555 C 187.4120788574219 108.4692306518555 184.2699279785156 105.3270797729492 184.2699279785156 101.5095901489258 L 184.2699279785156 101.5095901489258 Z M 230.0053405761719 119.6640853881836 L 230.0053405761719 119.6640853881836 C 227.0018920898438 129.765869140625 217.58203125 137.4140319824219 206.3871765136719 137.2753295898438 C 195.0585632324219 137.2753295898438 185.6370849609375 129.765869140625 182.6319580078125 119.5270309448242 C 187.8215637207031 127.0381393432617 196.5578308105469 132.0890502929688 206.3871765136719 132.0890502929688 C 216.2165222167969 132.0890502929688 224.9528198242188 127.0381393432617 230.0053405761719 119.6640853881836 L 230.0053405761719 119.6640853881836 Z M 227.2743225097656 104.2373123168945 L 227.2743225097656 104.2373123168945 L 212.1199951171875 104.2373123168945 L 212.1199951171875 98.91233062744141 L 227.2743225097656 98.91233062744141 L 227.2743225097656 104.2373123168945 Z" fill="#A7AAAE">
                </path>
              </svg>
            `,
          titremessageVide: `${this.$t("emptyMyfavorite")}`,
          messageVide: `${this.$t("emptyMyfavoriteMessage")}`,
          listing: listing2,
        },
      ];
    },
  },
  created() {
    document.title = this.$route.meta.title;
  },
};
</script>
<style>
* .loader-content {
  display: flex;
  align-items: center;
  justify-content: center;
}
.md-progress-spinner {
  margin: 16px;
}
.md-progress-spinner svg {
  height: 40px !important;
  width: 40px !important;
}
.md-progress-spinner .md-progress-spinner-circle {
  stroke: var(--primary) !important;
}
</style>
